import numpy as np


class CEDARH():
    
    #def __init__(self):
    #    pass
    
    def nindex(self,lam):
        A = 138.744
        B = 185.655
        L1 = 103.564e-9
        L2 = 13073.1e-6
        PressureFactor = 380 / 101.325 
        TemperatureFactor = 293.15 / 273.15
        ReducedIndex = A + B * np.exp(-lam / L1 - pow(lam / L2, 2.0))
        ReducedIndex *= (PressureFactor / TemperatureFactor)
        Index = 1.0 + (ReducedIndex * 1e-6)
        return Index
    
    def CedarHManginMirrorReflectivity(self,wavelength):
        x1 = wavelength
        refl = -999

        if(x1 <200):
            x1 = 200
        if(x1>400):
            x1 = 400

        refl = (-1.965162770562752e-06*x1**2 + 0.0013233545290043166*x1 + 0.6784368910822532)

        return refl

    def CondenserCEDARHTransmittance(self,iWindow, wavelength):
        x = wavelength
        f = -999
        iWindow += 1

        if(iWindow == 1):
            if(x >= 200 and x < 246) :
                f = 1.577777777776767e-06*pow(x,3) + -0.0011113939393932453*pow(x,2) + 0.2617405555553969*x + -19.695092121200073
            elif(x >= 246 and x < 295):
                f = 1.195545195546797e-07*pow(x,3) + -9.850394050406534e-05*pow(x,2) + 0.026947419617451993*x + -1.5265442779470744
            
            elif(x >= 295 and x < 400):
                f = -3.4588447403088225e-09*pow(x,3) + 5.290552468126538e-06*pow(x,2) + -0.0023091877718009897*x + 1.2290109453475577
            
            elif(x >= 400):
                f = 5.794513690872728e-10*pow(x,3) + -1.3338999345149037e-06*pow(x,2) + 0.001005061215784723*x + 0.7043713367806281

        elif(iWindow == 2):
            if(x >= 200 and x < 246):
                f = 1.4181818181810814e-06*pow(x,3) + -0.0010013030303025216*pow(x,2) + 0.2358583333332165*x + -17.609278181809263
            
            elif(x >= 246 and x < 295):
                f = 1.4545454545477698e-07*pow(x,3) + -0.00011485514485532668*pow(x,2) + 0.029900369630417162*x + -1.6432751248792588
            
            elif(x >= 295 and x < 400):
                f = -1.4850565148036634e-08*pow(x,3) + 1.7181033611685934e-05*pow(x,2) + -0.006393947824101988*x + 1.687921008053323
            
            elif(x >= 400):
                f = 6.631500336277707e-10*pow(x,3) + -1.5226110862017504e-06*pow(x,2) + 0.001141753883374947*x + 0.673982287267751

        elif(iWindow == 3):
            if(x >= 200 and x < 246):
                f = 1.3689199689191705e-06*pow(x,3) + -0.0009734662004656515*pow(x,2) + 0.23141935508922948*x + -17.472755757566198
            
            elif(x >= 246 and x < 295):
                f = 1.3706293706319882e-07*pow(x,3) + -0.00011260739260759928*pow(x,2) + 0.03070138861144292*x + -1.855250549455297
            
            elif(x >= 295 and x < 400):
                f = 3.88599958394153e-09*pow(x,3) + -2.4392225623362075e-06*pow(x,2) + 0.00038804832238753165*x + 0.9184595530327165
            
            elif(x >= 400):
                f = 5.88122369681063e-10*pow(x,3) + -1.3445799251343597e-06*pow(x,2) + 0.0010059659272938395*x + 0.7066367273307994

        elif(iWindow == 4):
            if(x >= 200 and x < 246):
                f = 1.2228438228432259e-06*pow(x,3) + -0.0008663543123538993*pow(x,2) + 0.20455947552438045*x + -15.171242424235151
            
            elif(x >= 246 and x < 295):
                f = 8.484848484861535e-08*pow(x,3) + -6.565634365644615e-05*pow(x,2) + 0.01662891774894454*x + -0.4555407592430898
            
            elif(x >= 295 and x < 400):
                f = -6.4406074474671376e-09*pow(x,3) + 7.997735445327513e-06*pow(x,2) + -0.003051052364110173*x + 1.2836928824034557
            
            elif(x >= 400):
                f = 7.430123994767228e-10*pow(x,3) + -1.6600725302076674e-06*pow(x,2) + 0.0012151094806848047*x + 0.6628583094082958

        elif(iWindow == 5):
            if(x >= 200 and x < 246):
                f = -1.3839937839928996e-06*pow(x,3) + -0.0009749673659667587*pow(x,2) + 0.23010238150724263*x + -17.283947878777333
            
            elif(x >= 246 and x < 295):
                f = 1.994301994303395e-07*pow(x,3) + -0.000166419358419465*pow(x,2) + 0.04619257224259925*x + -3.340412476414754
            
            elif(x >= 295 and x < 400):
                f = 2.2800083212029115e-09*pow(x,3) + -9.576153823340857e-07*pow(x,2) + -0.0001297388926846562*x + 0.986048577966476
            
            elif(x >= 400):
                f = 4.325504489792318e-10*pow(x,3) + -1.0835911946008326e-06*pow(x,2) + 0.0008801410315773978*x + 0.7204900971894472

        elif(iWindow == 6):
            if(x >= 200 and x < 246):
                f = 1.4595182595175041e-06*pow(x,3) + -0.0010376223776218559*pow(x,2) + 0.24688812742800745*x + -18.74701939393023
            
            elif(x >= 246 and x < 295):
                f = 1.8730898730928644e-07*pow(x,3) + -0.00015486091686115166*pow(x,2) + 0.04260589225595359*x + -2.978059129764461
            
            elif(x >= 295 and x < 400):
                f = -6.174329103382247e-09*pow(x,3) + 7.93079734909527e-06*pow(x,2) + -0.003172793931466069*x + 1.326162575410535
            
            elif(x >= 400):
                f = 5.411894117690164e-10*pow(x,3) + -1.2593826248755297e-06*pow(x,2) + 0.0009591252781701074*x + 0.7139879187387506
    
        elif(iWindow == 7):
            if(x >= 200 and x < 246):
                f = 1.3627039627031067e-06*pow(x,3) + -0.0009661958041952165*pow(x,2) + 0.22925737762224332*x + -17.289619393929208
            
            elif(x >= 246 and x < 295):
                f = 1.6451696451724818e-07*pow(x,3) + -0.00013684204684226943*pow(x,2) + 0.03784015059020874*x + -2.555102841607895
            
            elif(x >= 295 and x < 400):
                f = 1.8001525553075947e-09*pow(x,3) + -9.346369877326704e-07*pow(x,2) + 8.456280028352433e-05*x + 0.9325889209186513
            
            elif(x >= 400):
                f = 5.405154101204014e-10*pow(x,3) + -1.259259301649287e-06*pow(x,2) + 0.0009569964052291599*x + 0.7162850292248069

        elif(iWindow == 8):
            if(x >= 200 and x < 246):
                f = 1.0554778554772797e-06*pow(x,3) + -0.0007672587412583446*pow(x,2) + 0.18669247086237992*x + -14.285401212114273
            
            elif(x >= 246 and x < 295):
                f = 1.3986013986032013e-07*pow(x,3) + -0.00011643956043970091*pow(x,2) + 0.03224649350652995*x + -2.0470113886145342
            
            elif(x >= 295 and x < 400):
                f =-5.930240621305815e-09*pow(x,3) + 7.647811227663594e-06*pow(x,2) + -0.0030601841758512173*x + 1.3120244138009223
            
            elif(x >= 400):
                f = 4.662421711497515e-10*pow(x,3) + -1.1227698241875224e-06*pow(x,2) + 0.0008742843043434002*x + 0.7322697518632778

        if(f < 0):
            return 0

        if(f > 0.999):
            f = 0.999

        return f



    def QuartzWindowCEDARHTransmittance(self,iWindow,Wavelength):
        x = Wavelength
        f = -999
        if(x < 218):
            return 0
        if(x > 700):
            x = 700
            
        iWindow += 1
        
        #print(iWindow)

        if(iWindow == 1):
            if(x >= 218 and x < 246):
                f = -4.11039779e-05 * pow(x, 3) + 2.86929772e-02 * pow(x, 2) + -6.64646618e+00 * x + 5.11186456e+02
        
            elif(x >= 246 and x < 295):
                f = 2.16681351e-06 * pow(x, 3) + -1.81862119e-03 * pow(x, 2) + 5.11346718e-01 * x + -4.73737467e+01
        
            elif(x >= 295 and x < 400):
                f = 8.43738855e-08 * pow(x, 3) + -9.49909704e-05 * pow(x, 2) + 3.59630121e-02 * x - 3.67506532e+00
        
            elif(x >= 400):
                f = -2.274769294566873e-10 * pow(x, 3) + 3.6319254670767923e-07 * pow(x, 2)+ -0.00013165099898537937 * x + 0.9221299285871312
        
        
        elif(iWindow == 2):
            if(x >= 218 and x < 246):
                f = -3.809435193594334e-05 * pow(x, 3) + 0.02668671852791952 * pow(x, 2) + -6.204074022979601 * x + 478.90810305848214
        
            elif(x >= 246 and x < 295):
                f = 2.3804438810233594e-06 * pow(x, 3) + -0.0019908839971722273 * pow(x, 2) + 0.5580549708678741 * x + -51.67585798284769

            elif(x >= 295 and x < 400):
                f = 9.423628212043439e-08 * pow(x, 3) + -0.00010522846641591158 * pow(x, 2) + 0.03960381808064974 * x + -4.139946820550639
        
            elif(x >= 400):
                f = 7.608954764150227e-11 * pow(x, 3) + -2.1708751926807533e-07 * pow(x, 2) + 0.00024143630452548747 * x + 0.8288143590890062
        
        
        elif(iWindow == 3):
            if(x >= 218 and x < 246):
                f = -4.069328496912898e-05 * pow(x, 3) + 0.028292809671339503 * pow(x, 2) + -6.525570292072722 * x + 499.5919906136786
        
            elif(x >= 246 and x < 295):
                f = 2.4302513889536216e-06 * pow(x, 3) + -0.0020445038036341263 * pow(x, 2) + 0.5753972506367294 * x + -53.335503221314696
        
            elif(x >= 295 and x < 400):
                f = 5.4720284121751934e-08 * pow(x, 3) + -6.23705802941529e-05 * pow(x, 2) + 0.023899000523567884 * x + -2.1535449437836705
        
            elif(x >= 400):
                f = -2.585477114727037e-10 * pow(x, 3) + 5.634304819624665e-07 * pow(x, 2) + -0.0003721156186314771 * x + 1.0047948358674903
        
        
        elif(iWindow == 4):
            if(x >= 218 and x < 246):
                f = -3.9805092701628935e-05 * pow(x, 3) + 0.0276399718320393 * pow(x, 2) + -6.366615630899579 * x + 486.76440070327584

            elif(x >= 246 and x < 295):
                f = 2.607804718903866e-06 * pow(x, 3) + -0.002179702907292894 * pow(x, 2) + 0.6091310433266354 * x + -56.104031788219416
        
            elif(x >= 295 and x < 400):
                f = 5.394902648645878e-08 * pow(x, 3) + -5.974478622231392e-05 * pow(x, 2) + 0.02238637937967184 * x + -1.9401420527649282
        
            elif(x >= 400):
                f = -1.3424815024391928e-10 * pow(x, 3) + 2.8328557253805954e-07 * pow(x, 2) + -0.00014759288847822986 * x + 0.9296519676340556
        
        
        elif(iWindow == 5):
            if(x >= 218 and x < 246):
                f = -4.026044807217661e-05 * pow(x, 3) + 0.028125087268148063 * pow(x, 2) + -6.519851609425991 * x + 501.83282403472884
        
            elif(x >= 246 and x < 295):
                f = 2.2998584298082745e-06 * pow(x, 3) + -0.0019281932769371166 * pow(x, 2) + 0.5416658346847079 * x + -50.19632882594679
        
            elif(x >= 295 and x < 400):
                f = 8.116988471060152e-08 * pow(x, 3) + -9.07196710390931e-05 * pow(x, 2) + 0.03412930128016914 * x + -3.4208602086264928
        
            elif(x >= 400):
                f = -2.6893392890493907e-10 * pow(x, 3) + 5.13205980921548e-07 * pow(x, 2) + -0.00026751528092079614 * x + 0.9530332732775446
        
        
        elif(iWindow == 6):
            if(x >= 218 and x < 246):
                f = -3.1223931316470255e-05 * pow(x, 3) + 0.021725868519426587 * pow(x, 2) + -5.013593174756257 * x + 383.96044849868076
        
            elif(x >= 246 and x < 295):
                f = 9.482373230648229e-07 * pow(x, 3) + -0.0008334196897081745 * pow(x, 2) + 0.24756877704241154 * x + -24.0374603259202
        
            elif(x >= 295 and x < 400):
                f = 8.233301744707107e-08 * pow(x, 3) + -9.547507479847616e-05 * pow(x, 2) + 0.03730903576361997 * x + -4.001761422102015
        
            elif(x >= 400):
                f = -1.904338123217788e-11 * pow(x, 3) + 8.409502647180658e-08 * pow(x, 2) + -3.142433346301535e-05 * x + 0.9167920493061781
        
        
        elif(iWindow == 7):
            if(x >= 218 and x < 246):
                f = -2.230030342970399e-05 * pow(x, 3) + 0.015758350387650513 * pow(x, 2)  + -3.6919233798262407 * x + 286.9850887177151
        
            elif(x >= 246 and x < 295):
                f = 8.092332381485389e-07 * pow(x, 3) + -0.0007049118121416209 * pow(x, 2) + 0.21032333990143628 * x + -20.715816098932855
        
            elif(x >= 295 and x < 400):
                f = 1.421072371469425e-07 * pow(x, 3) + -0.00016431097943130294 * pow(x, 2) + 0.06387164658393837 * x + -7.432497926036235
        
            elif(x >= 400):
                f = -6.0609476804551776e-12 * pow(x, 3) + 6.973713082744009e-08 * pow(x, 2) + -3.277227443220169e-05 * x + 0.9234629146656347
        
        
        elif(iWindow == 8):
            if(x >= 218 and x < 246):
                f = -3.845369558874715e-05 * pow(x, 3) + 0.026718480620871746 * pow(x, 2) + -6.157507418160105 * x + 470.97393467081884
        
            elif(x >= 246 and x < 295):
                f = 2.3730263844012878e-06 * pow(x, 3) + -0.001990596260159832 * pow(x, 2) + 0.5589009348299779 * x + -51.69416071431379
        
            elif(x >= 295 and x < 400):
                f = 7.207227590276765e-08 * pow(x, 3) + -7.976339347725213e-05 * pow(x, 2) + 0.029690116647956177 * x + -2.796019060080562
        
            elif(x >= 400):
                f = -1.0411189727864261e-10 * pow(x, 3) + 2.500134423383643e-07 * pow(x, 2) + -0.00017823574678597754 * x + 0.9676533585243703
        
        
        if(f < 0):
            return 0

        if(f > 0.999):
            f = 0.999

        return f


    def CedarHSphericalMirrorReflectivity(self,iMirror ,wavelength):
        x1 = wavelength
        refl = -999

        if(x1 <200):
            x1 = 200
        if(x1>800):
            x1 = 800

        if(iMirror == 1 or iMirror == 2 or iMirror == 3 or iMirror == 4 ):
            if(x1 < 340):
                refl = 1.7503719232231257e-07*pow(x1,3) + -0.0001596808495789322*pow(x1,2) + 0.048857897746371254*x1 + -4.120786832355275
            elif(x1 < 450):
                refl = 5.07367534543746e-09*pow(x1,3) + -6.9658486520414895e-06*pow(x1,2) + 0.003204793595402563*x1 + 0.42193638722713334
            elif(x1 < 490):
                refl = 2.7843020497708595e-08*pow(x1,3) + -5.5929818802174974e-05*pow(x1,2) + 0.03407773514304427*x1 + -5.630358154936731
            elif(x1 < 540):
                refl = 7.972203487895105e-08*pow(x1,3) + -0.0001308947137214204*pow(x1,2) + 0.07144517164840263*x1 + -12.042983827205052
            else:
                refl = -2.0009844418537285e-09*pow(x1,3) + 3.5117863431957253e-06*pow(x1,2) + -0.0021530742879973357*x1 + 1.3760961631194457
        else:
            if(x1 < 340):
                refl = 1.7518669459117822e-07*pow(x1,3) + -0.00016296140594633356*pow(x1,2) + 0.05099325780096057*x1 + -4.4801530911941
            elif(x1 < 450):
                refl = 5.477527447075879e-09*pow(x1,3) + -7.777977432276705e-06*pow(x1,2) + 0.0036872784284818815*x1 + 0.3301926344217908
            elif(x1 < 490):
                refl = 1.1325162681906962e-07*pow(x1,3) + -0.00017645724875344618*pow(x1,2) + 0.09077157985000432*x1 + -14.520756348484962
            elif(x1 < 540):
                refl = 1.6503454669294843e-07*pow(x1,3) + -0.00026256926589008224*pow(x1,2) + 0.13917412934410633*x1 + -23.65384510620587
            else:
                refl = -2.07506853009322e-09*pow(x1,3) + 3.6427218551639454e-06*pow(x1,2) + -0.002226367552781621*x1 + 1.3882619718539608


        if(refl < 0):
            refl = 0
        if(refl > 1):
            refl = 1
        return refl    
    
    
    def CedarQE_EMI_9820_QB(wavelength):

        wlraw = wavelength 
        wl = 141.0 if wlraw < 141.0 else 649.0 if wlraw > 649.0 else wlraw
        wls = [140, 160, 180, 200, 220, 240, 260, 280, 300, 320, 340, 360,
                                    380, 400, 420, 440, 460, 480, 500, 520, 540, 560, 600, 650]
        qes = [0,    20, 21.6, 21.6, 21.4, 21.4, 22,   24, 25, 25.6, 26, 26,
                                    26.4, 26, 24.8, 23.2, 20.8, 18,   15.2, 12, 8,  5.6,  2,  0]

        i = 0;
        while(True):
            if(wl > wls[i] and wl < wls[i + 1]):
                break
            else:
                ++i;
        
        return 0.01 * (qes[i] + (wl - wls[i]) / (wls[i + 1] - wls[i]) * (qes[i + 1] - qes[i]))
    
    def CedarQE_R7400U_03(wavelength):
        par = [-58.41145755814,     1.450540667766,      -0.01561331198442,
                                    9.545010080831e-05,  -3.648461145542e-07, 9.047599515597e-10,
                                    -1.457151808585e-12, 1.471328774241e-15,  -8.46121819724e-19,
                                    2.11384701372e-22]

        x = wavelength
        if(x < 180):
            return 0
        if(x > 660):
            return 0
        qe = 0;
        for i in range(10):
            qe += par[i] * pow(x, i);
        if(qe < 0):
            qe = 0
        return qe
